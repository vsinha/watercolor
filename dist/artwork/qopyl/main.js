(()=>{var v=.1;function y(s){if(s.length==0)return createVector(0,0);let t=s.map(i=>i.x).reduce((i,o)=>i+o),e=s.map(i=>i.y).reduce((i,o)=>i+o);return createVector(t/s.length,e/s.length)}function p(s){return s.magSq()>1&&s.setMag(1),s}var c=class{constructor(t,e){this.pos=createVector(t,e),this.radius=100,this.avoidRadius=20,this.alignRadius=50,this.speed=1,this.velocity=createVector(random(-1,1),random(-1,1)).normalize().mult(100)}draw(){stroke("lightblue"),strokeWeight(4),point(this.pos.x,this.pos.y),strokeWeight(2)}getNeighbors(t,e){return e.filter(i=>i!=this&&this.pos.dist(i.pos)<t)}vecTowardsCenter(t){return t.length==0?createVector(0,0):p(y(t).sub(this.pos))}update(t,e){let i=this.vecTowardsCenter(this.getNeighbors(this.radius,e).map(a=>a.pos)),o=this.vecTowardsCenter(this.getNeighbors(this.avoidRadius,e).map(a=>a.pos)).mult(-1),r=this.vecTowardsCenter(this.getNeighbors(this.alignRadius,e).map(a=>a.velocity)),d=mouseIsPressed?p(createVector(mouseX,mouseY).sub(this.pos)):createVector(0,0),g=3,w=10,x=1,f=100,b=i.mult(g).add(o.mult(w)).add(r.mult(x)).add(d.mult(f)).normalize(),m=.1;this.velocity.mult(1-m).add(b.mult(m)).normalize().mult(v).mult(t),this.pos.add(this.velocity)}};var n=class{constructor(t,e,i,o,r,d){this.parent=t,this.depth=d,this.x=e,this.y=i,this.width=o,this.height=r,this.children=[],this.points=[],this.maxPoints=4}createSubQuads(){let t=this.width/2,e=this.height/2,i=this.x,o=this.y,r=this.depth+1;return[new n(this,i,o,t,e,r),new n(this,i+t,o,t,e,r),new n(this,i,o+e,t,e,r),new n(this,i+t,o+e,t,e,r)]}contains(t){return t.pos.x>=this.x&&t.pos.y>=this.y&&t.pos.x<this.x+this.width&&t.pos.y<this.y+this.height}insert(t){if(this.children.length==0&&this.points.length<this.maxPoints){this.points.push(t);return}this.children.length==0&&(this.children=this.createSubQuads(),this.points.forEach(e=>this.insert(e)),this.points=[]),this.children.forEach(e=>{e.contains(t)&&e.insert(t)})}draw(){this.depth>2&&this.points.length>0&&(stroke("gray"),strokeWeight(.2),noFill(),beginShape(),vertex(this.x,this.y),vertex(this.x+this.width,this.y),vertex(this.x+this.width,this.y+this.height),vertex(this.x,this.y+this.height),endShape(CLOSE)),this.children.forEach(t=>{t.draw()})}},u=class{insert(t){!this.root.contains(t)||this.root.insert(t)}draw(){this.root.draw()}constructor(t,e,i,o,r){this.root=new n(void 0,t,e,i,o,0),r.forEach(d=>this.insert(d))}};var h=[],l=!1,T=(s,t,e,i)=>{h=Array.from({length:i},()=>new c(random(0,s),random(0,t))),l=e};function V(){console.log(mouseX,mouseY)}var P=()=>{createCanvas(windowWidth,windowHeight),T(windowWidth,windowHeight,!0,200)},E=s=>{background("rgba(0, 0, 0, 1)"),h.forEach(t=>t.update(s,h)),h.forEach(t=>{t.pos.x<0?t.pos.x=width:t.pos.x>=width&&(t.pos.x=0),t.pos.y<0?t.pos.y=height:t.pos.y>=height&&(t.pos.y=0)}),l&&new u(0,0,width,height,h).draw(),h.forEach(t=>t.draw())},k=()=>{E(deltaTime)};Object.assign(window,{setup:P,draw:k,mouseClicked:V});})();
